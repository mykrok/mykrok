# Release Checklist

Before creating any release (major, minor, or patch), complete these steps:

## Pre-Release Verification

### 1. Run All Tests

```bash
# Run full test suite
uv run tox

# Or run individual test environments
uv run tox -e py3,lint,type,jslint,jstest
```

All tests must pass before proceeding.

### 2. Verify JavaScript Assets

```bash
# Check that all imported modules exist
cd src/mykrok/assets/map-browser/
for import in $(grep -oP "from '\./\K[^']+(?=')" map-browser.js); do
    [ -f "$import" ] || echo "MISSING: $import"
done

# Run JavaScript tests
npm test
```

### 3. Test create-browser Command

```bash
# Generate browser in a test data directory
uv run mykrok create-browser --serve

# Verify in browser:
# - Page loads without JavaScript errors (check console)
# - Map view works
# - Sessions view works
# - Stats view works
# - Photo viewer opens (if photos exist)
```

### 4. Verify Version Consistency

```bash
# Check current version
uv run python -c "from mykrok import __version__; print(__version__)"

# Ensure CHANGELOG has entry for new version
head -20 CHANGELOG.md
```

## Release Steps

### 1. Update CHANGELOG.md

Add entry at top with:
- Version number and date
- Features (üöÄ)
- Bug Fixes (üêõ)
- Improvements (üîß)
- Breaking Changes (‚ö†Ô∏è) if any
- Authors

### 2. Commit and Tag

```bash
# Commit CHANGELOG
git add CHANGELOG.md
git commit -m "Release vX.Y.Z"

# Create annotated tag with CHANGELOG content
git tag -a vX.Y.Z -m "$(cat <<'EOF'
vX.Y.Z (YYYY-MM-DD)

[Copy CHANGELOG entry here]
EOF
)"
```

### 3. Push Release

```bash
git push && git push --tags
```

## Post-Release Verification

After pushing:

1. **Check CI**: Verify GitHub Actions pass on the tagged commit
2. **Check Demo**: If gh-pages updates, verify demo site works
3. **Verify Tag**: `git describe` should show new version

## Version Numbering

Follow [Semantic Versioning](https://semver.org/):

- **MAJOR** (X.0.0): Breaking changes
- **MINOR** (0.X.0): New features, backward compatible
- **PATCH** (0.0.X): Bug fixes only

## Common Issues

### Missing JavaScript Module

If `map-browser.js` imports a module that doesn't exist:
1. Check `src/mykrok/assets/map-browser/` for the file
2. Create the missing module or inline the code
3. Run `npm test` to verify

### Tests Fail After Merge

If tests fail after merging a feature branch:
1. Check for conflicting changes
2. Run `uv run tox` to see all failures
3. Fix issues before releasing

### Version Mismatch

The `_version.py` file is auto-generated by setuptools-scm from git tags.
Don't edit it manually - just create the tag and it will update.
